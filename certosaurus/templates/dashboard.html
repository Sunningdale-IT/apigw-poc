{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <div class="page-title-icon">ğŸ¦–</div>
        RAWR! Welcome back, {{ user.username }}!
    </h1>
    <p class="page-description">Here's an overview of your certificate kingdom.</p>
</div>

<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card green">
        <div class="stat-icon">ğŸ¦´</div>
        <div class="stat-value">{{ ca_count }}</div>
        <div class="stat-label">Certificate Authorities</div>
    </div>
    
    <div class="stat-card amber">
        <div class="stat-icon">ğŸŒ‹</div>
        <div class="stat-value">{{ server_cert_count }}</div>
        <div class="stat-label">Active Server Certs</div>
    </div>
    
    <div class="stat-card lime">
        <div class="stat-icon">ğŸ¥š</div>
        <div class="stat-value">{{ client_cert_count }}</div>
        <div class="stat-label">Active Client Certs</div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">ğŸ¦¶ Quick Actions</h3>
    </div>
    <div class="flex gap-2" style="flex-wrap: wrap;">
        <a href="{% url 'ca_create' %}" class="btn btn-primary">
            â• Hatch New CA
        </a>
        <a href="{% url 'server_cert_create' %}" class="btn btn-secondary">
            ğŸŒ‹ New Server Certificate
        </a>
        <a href="{% url 'client_cert_create' %}" class="btn btn-accent">
            ğŸ¥š New Client Certificate
        </a>
    </div>
</div>

<div class="cert-detail-grid">
    <!-- Expiring Soon -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">â˜„ï¸ Going Extinct Soon</h3>
        </div>
        
        {% if expiring_server or expiring_client %}
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                {% for cert in expiring_server %}
                    <div class="expiry-warning">
                        <span>ğŸŒ‹</span>
                        <a href="{% url 'server_cert_detail' cert.pk %}">{{ cert.name }}</a>
                        <span>- {{ cert.days_until_expiry }} days left</span>
                    </div>
                {% endfor %}
                {% for cert in expiring_client %}
                    <div class="expiry-warning">
                        <span>ğŸ¥š</span>
                        <a href="{% url 'client_cert_detail' cert.pk %}">{{ cert.name }}</a>
                        <span>- {{ cert.days_until_expiry }} days left</span>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center" style="padding: 2rem; color: var(--text-secondary);">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ¦•</div>
                <p>No certificates going extinct soon!</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Recent CAs -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">ğŸ¦´ Recent CAs</h3>
            <a href="{% url 'ca_list' %}" class="btn btn-outline btn-sm">View All</a>
        </div>
        
        {% if recent_cas %}
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                {% for ca in recent_cas %}
                    <div class="flex items-center justify-between" style="padding: 0.5rem; background: var(--bg-primary); border-radius: 8px;">
                        <div>
                            <a href="{% url 'ca_detail' ca.pk %}" style="font-weight: 700;">{{ ca.name }}</a>
                            <span class="badge {% if ca.is_root %}badge-root{% else %}badge-intermediate{% endif %}" style="margin-left: 0.5rem;">
                                {% if ca.is_root %}Alpha{% else %}Beta{% endif %}
                            </span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center" style="padding: 2rem; color: var(--text-secondary);">
                <p>No CAs hatched yet. <a href="{% url 'ca_create' %}">Hatch one!</a></p>
            </div>
        {% endif %}
    </div>
</div>

<div class="cert-detail-grid mt-3">
    <!-- Recent Server Certs -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">ğŸŒ‹ Recent Server Certs</h3>
            <a href="{% url 'server_cert_list' %}" class="btn btn-outline btn-sm">View All</a>
        </div>
        
        {% if recent_server_certs %}
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                {% for cert in recent_server_certs %}
                    <div class="flex items-center justify-between" style="padding: 0.5rem; background: var(--bg-primary); border-radius: 8px;">
                        <div>
                            <a href="{% url 'server_cert_detail' cert.pk %}" style="font-weight: 700;">{{ cert.name }}</a>
                            <span class="badge badge-{{ cert.status }}" style="margin-left: 0.5rem;">{{ cert.status }}</span>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">{{ cert.common_name }}</div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center" style="padding: 2rem; color: var(--text-secondary);">
                <p>No server certificates yet. <a href="{% url 'server_cert_create' %}">Create one!</a></p>
            </div>
        {% endif %}
    </div>
    
    <!-- Recent Client Certs -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">ğŸ¥š Recent Client Certs</h3>
            <a href="{% url 'client_cert_list' %}" class="btn btn-outline btn-sm">View All</a>
        </div>
        
        {% if recent_client_certs %}
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                {% for cert in recent_client_certs %}
                    <div class="flex items-center justify-between" style="padding: 0.5rem; background: var(--bg-primary); border-radius: 8px;">
                        <div>
                            <a href="{% url 'client_cert_detail' cert.pk %}" style="font-weight: 700;">{{ cert.name }}</a>
                            <span class="badge badge-{{ cert.status }}" style="margin-left: 0.5rem;">{{ cert.status }}</span>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">{{ cert.common_name }}</div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center" style="padding: 2rem; color: var(--text-secondary);">
                <p>No client certificates yet. <a href="{% url 'client_cert_create' %}">Hatch one!</a></p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
